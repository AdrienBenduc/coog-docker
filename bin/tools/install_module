#!/bin/bash
set -euo pipefail

BASE_PATH=`realpath "$(dirname $0)/../.."`
. "${BASE_PATH}/bin/helpers/colors.sh"

cur_dir=$PWD

if [[ "${1:-not_set}" = "not_set" ]]; then
    echo "Missing module name"
    echo ""
    echo "Usage: install_module <module_1> [module_2] ..."
    exit 1
fi

echo " "
section "Loading required informations"

db_name=$(source $BASE_PATH/.env && echo $COOG_MAIN_DATABASE)

if [[ ! "$db_name" ]]; then
    echo "Could not extract database name from .env file"
    exit 1
else
    echo "Target database: $db_name"
fi

# Module update
echo " "
section "Starting module update"
cd $PWD
docker-compose exec -- coog ep admin \
    -d "$db_name" -u $1 --activate-dependencies
